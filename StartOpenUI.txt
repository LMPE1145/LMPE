-- Roblox UI库 - NeoUI Library
-- 作者: AI Assistant
-- 版本: 1.0

local NeoUI = {}
NeoUI.__index = NeoUI

-- 颜色配置
NeoUI.Colors = {
    Primary = Color3.fromRGB(0, 120, 215),
    Secondary = Color3.fromRGB(100, 100, 100),
    Success = Color3.fromRGB(76, 175, 80),
    Danger = Color3.fromRGB(244, 67, 54),
    Warning = Color3.fromRGB(255, 193, 7),
    Dark = Color3.fromRGB(33, 33, 33),
    Light = Color3.fromRGB(250, 250, 250),
    Background = Color3.fromRGB(45, 45, 45),
    Surface = Color3.fromRGB(55, 55, 55)
}

-- 字体配置
NeoUI.Fonts = {
    Title = Enum.Font.GothamBold,
    Heading = Enum.Font.GothamMedium,
    Body = Enum.Font.Gotham,
    Code = Enum.Font.RobotoMono
}

-- 创建基础UI容器
function NeoUI:CreateScreenGui(name, parent)
    parent = parent or game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = name
    screenGui.Parent = parent
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.ResetOnSpawn = false
    
    return screenGui
end

-- 创建框架组件
function NeoUI:CreateFrame(name, parent, size, position, backgroundColor, cornerRadius)
    local frame = Instance.new("Frame")
    frame.Name = name
    frame.Size = size or UDim2.new(0, 200, 0, 150)
    frame.Position = position or UDim2.new(0, 0, 0, 0)
    frame.BackgroundColor3 = backgroundColor or self.Colors.Surface
    frame.BorderSizePixel = 0
    frame.Parent = parent
    
    if cornerRadius then
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, cornerRadius)
        corner.Parent = frame
    end
    
    return frame
end

-- 创建按钮组件
function NeoUI:CreateButton(name, parent, text, size, position, buttonStyle)
    buttonStyle = buttonStyle or "primary"
    
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = size or UDim2.new(0, 120, 0, 40)
    button.Position = position or UDim2.new(0, 0, 0, 0)
    button.BackgroundColor3 = self.Colors[buttonStyle:gsub("^%l", string.upper)] or self.Colors.Primary
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Text = text or "Button"
    button.Font = self.Fonts.Body
    button.TextSize = 14
    button.AutoButtonColor = false
    button.Parent = parent
    
    -- 圆角
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    -- 悬停效果
    local originalColor = button.BackgroundColor3
    local hoverColor = Color3.new(
        math.min(originalColor.R * 1.2, 1),
        math.min(originalColor.G * 1.2, 1),
        math.min(originalColor.B * 1.2, 1)
    )
    
    button.MouseEnter:Connect(function()
        game:GetService("TweenService"):Create(button, TweenInfo.new(0.2), {BackgroundColor3 = hoverColor}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        game:GetService("TweenService"):Create(button, TweenInfo.new(0.2), {BackgroundColor3 = originalColor}):Play()
    end)
    
    -- 点击效果
    button.MouseButton1Down:Connect(function()
        game:GetService("TweenService"):Create(button, TweenInfo.new(0.1), {Size = size - UDim2.new(0, 4, 0, 4)}):Play()
    end)
    
    button.MouseButton1Up:Connect(function()
        game:GetService("TweenService"):Create(button, TweenInfo.new(0.1), {Size = size}):Play()
    end)
    
    return button
end

-- 创建标签组件
function NeoUI:CreateLabel(name, parent, text, size, position, textStyle)
    textStyle = textStyle or "body"
    
    local label = Instance.new("TextLabel")
    label.Name = name
    label.Size = size or UDim2.new(1, 0, 0, 20)
    label.Position = position or UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Text = text or "Label"
    label.Font = self.Fonts[textStyle:gsub("^%l", string.upper)] or self.Fonts.Body
    label.TextSize = textStyle == "title" and 18 or textStyle == "heading" and 16 or 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = parent
    
    return label
end

-- 创建文本框组件
function NeoUI:CreateTextBox(name, parent, placeholder, size, position)
    local textBoxFrame = self:CreateFrame(name .. "Frame", parent, size, position, self.Colors.Dark, 8)
    textBoxFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    
    local textBox = Instance.new("TextBox")
    textBox.Name = name
    textBox.Size = UDim2.new(1, -16, 1, -16)
    textBox.Position = UDim2.new(0, 8, 0, 8)
    textBox.BackgroundTransparency = 1
    textBox.TextColor3 = Color3.new(1, 1, 1)
    textBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    textBox.PlaceholderText = placeholder or "Enter text..."
    textBox.Text = ""
    textBox.Font = self.Fonts.Body
    textBox.TextSize = 14
    textBox.ClearTextOnFocus = false
    textBox.Parent = textBoxFrame
    
    -- 焦点效果
    textBox.Focused:Connect(function()
        game:GetService("TweenService"):Create(textBoxFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 50)}):Play()
    end)
    
    textBox.FocusLost:Connect(function()
        game:GetService("TweenService"):Create(textBoxFrame, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 35, 35)}):Play()
    end)
    
    return textBox
end

-- 创建滑动条组件
function NeoUI:CreateSlider(name, parent, minValue, maxValue, defaultValue, size, position)
    local sliderFrame = self:CreateFrame(name .. "Frame", parent, size, position, self.Colors.Dark, 8)
    sliderFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    
    local fillFrame = self:CreateFrame("Fill", sliderFrame, UDim2.new((defaultValue - minValue) / (maxValue - minValue), 0, 1, 0), UDim2.new(0, 0, 0, 0), self.Colors.Primary, 8)
    
    local sliderButton = Instance.new("TextButton")
    sliderButton.Name = name
    sliderButton.Size = UDim2.new(0, 20, 1, -8)
    sliderButton.Position = UDim2.new((defaultValue - minValue) / (maxValue - minValue), -10, 0, 4)
    sliderButton.BackgroundColor3 = Color3.new(1, 1, 1)
    sliderButton.Text = ""
    sliderButton.AutoButtonColor = false
    sliderButton.Parent = sliderFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = sliderButton
    
    local valueLabel = self:CreateLabel("Value", sliderFrame, tostring(defaultValue), UDim2.new(0, 40, 0, 20), UDim2.new(1, 5, 0, -25), "body")
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    
    -- 滑动逻辑
    local isDragging = false
    
    local function updateSlider(xPosition)
        local relativeX = math.clamp((xPosition - sliderFrame.AbsolutePosition.X) / sliderFrame.AbsoluteSize.X, 0, 1)
        local value = minValue + (maxValue - minValue) * relativeX
        value = math.floor(value * 100) / 100 -- 保留两位小数
        
        sliderButton.Position = UDim2.new(relativeX, -10, 0, 4)
        fillFrame.Size = UDim2.new(relativeX, 0, 1, 0)
        valueLabel.Text = tostring(value)
        
        return value
    end
    
    sliderButton.MouseButton1Down:Connect(function()
        isDragging = true
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = false
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateSlider(input.Position.X)
        end
    end)
    
    sliderFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            local value = updateSlider(input.Position.X)
            -- 触发自定义事件
            if sliderFrame:FindFirstChild("OnValueChanged") then
                sliderFrame.OnValueChanged:Fire(value)
            end
        end
    end)
    
    -- 创建事件
    local valueChangedEvent = Instance.new("BindableEvent")
    valueChangedEvent.Name = "OnValueChanged"
    valueChangedEvent.Parent = sliderFrame
    
    return sliderFrame
end

-- 创建切换开关组件
function NeoUI:CreateToggle(name, parent, defaultState, size, position)
    local toggleFrame = self:CreateFrame(name .. "Frame", parent, size or UDim2.new(0, 50, 0, 25), position, self.Colors.Dark, 12)
    
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = name
    toggleButton.Size = UDim2.new(0, 21, 0, 21)
    toggleButton.Position = defaultState and UDim2.new(1, -23, 0, 2) or UDim2.new(0, 2, 0, 2)
    toggleButton.BackgroundColor3 = defaultState and self.Colors.Success or Color3.fromRGB(150, 150, 150)
    toggleButton.Text = ""
    toggleButton.AutoButtonColor = false
    toggleButton.Parent = toggleFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = toggleButton
    
    local state = defaultState or false
    
    toggleButton.MouseButton1Click:Connect(function()
        state = not state
        local targetPosition = state and UDim2.new(1, -23, 0, 2) or UDim2.new(0, 2, 0, 2)
        local targetColor = state and self.Colors.Success or Color3.fromRGB(150, 150, 150)
        
        game:GetService("TweenService"):Create(toggleButton, TweenInfo.new(0.2), {Position = targetPosition, BackgroundColor3 = targetColor}):Play()
        
        -- 触发自定义事件
        if toggleFrame:FindFirstChild("OnStateChanged") then
            toggleFrame.OnStateChanged:Fire(state)
        end
    end)
    
    -- 创建事件
    local stateChangedEvent = Instance.new("BindableEvent")
    stateChangedEvent.Name = "OnStateChanged"
    stateChangedEvent.Parent = toggleFrame
    
    return toggleFrame
end

-- 创建下拉菜单组件
function NeoUI:CreateDropdown(name, parent, options, defaultOption, size, position)
    local dropdownFrame = self:CreateFrame(name .. "Frame", parent, size or UDim2.new(0, 150, 0, 35), position, self.Colors.Dark, 8)
    
    local dropdownButton = self:CreateButton(name .. "Button", dropdownFrame, defaultOption or "Select...", UDim2.new(1, -10, 1, -10), UDim2.new(0, 5, 0, 5), "secondary")
    dropdownButton.ZIndex = 2
    
    local optionsFrame = self:CreateFrame("Options", dropdownFrame, UDim2.new(1, 0, 0, 0), UDim2.new(0, 0, 1, 5), self.Colors.Surface, 8)
    optionsFrame.Visible = false
    optionsFrame.ClipsDescendants = true
    optionsFrame.ZIndex = 3
    
    local layout = Instance.new("UIListLayout")
    layout.Parent = optionsFrame
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    
    local isOpen = false
    local selectedOption = defaultOption
    
    local function updateOptionsHeight()
        local optionCount = #optionsFrame:GetChildren() - 1 -- 减去UIListLayout
        optionsFrame.Size = UDim2.new(1, 0, 0, math.min(optionCount * 30, 150))
    end
    
    -- 创建选项按钮
    for i, option in ipairs(options) do
        local optionButton = self:CreateButton("Option" .. i, optionsFrame, option, UDim2.new(1, -10, 0, 25), UDim2.new(0, 5, 0, (i-1)*30 + 5), "surface")
        optionButton.ZIndex = 4
        optionButton.BackgroundColor3 = self.Colors.Surface
        
        optionButton.MouseButton1Click:Connect(function()
            selectedOption = option
            dropdownButton.Text = option
            isOpen = false
            optionsFrame.Visible = false
            
            -- 触发自定义事件
            if dropdownFrame:FindFirstChild("OnOptionSelected") then
                dropdownFrame.OnOptionSelected:Fire(option)
            end
        end)
    end
    
    updateOptionsHeight()
    
    dropdownButton.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        optionsFrame.Visible = isOpen
    end)
    
    -- 创建事件
    local optionSelectedEvent = Instance.new("BindableEvent")
    optionSelectedEvent.Name = "OnOptionSelected"
    optionSelectedEvent.Parent = dropdownFrame
    
    return dropdownFrame
end

-- 创建窗口组件
function NeoUI:CreateWindow(name, parent, title, size, position)
    local window = self:CreateFrame(name, parent, size or UDim2.new(0, 300, 0, 400), position, self.Colors.Background, 12)
    window.ClipsDescendants = true
    
    -- 标题栏
    local titleBar = self:CreateFrame("TitleBar", window, UDim2.new(1, 0, 0, 40), UDim2.new(0, 0, 0, 0), self.Colors.Primary, 12)
    titleBar.ZIndex = 2
    
    local titleLabel = self:CreateLabel("Title", titleBar, title or "Window", UDim2.new(1, -40, 1, 0), UDim2.new(0, 15, 0, 0), "heading")
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.ZIndex = 3
    
    -- 关闭按钮
    local closeButton = self:CreateButton("CloseButton", titleBar, "X", UDim2.new(0, 30, 0, 30), UDim2.new(1, -35, 0, 5), "danger")
    closeButton.ZIndex = 3
    
    -- 内容区域
    local contentFrame = self:CreateFrame("Content", window, UDim2.new(1, -20, 1, -60), UDim2.new(0, 10, 0, 50), Color3.fromRGB(0, 0, 0, 0))
    contentFrame.BackgroundTransparency = 1
    
    -- 拖动功能
    local dragging = false
    local dragInput, dragStart, startPos
    
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = window.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    titleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            window.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    
    closeButton.MouseButton1Click:Connect(function()
        window:Destroy()
    end)
    
    return window, contentFrame
end

-- 使用示例
function NeoUI:CreateExampleUI()
    local screenGui = self:CreateScreenGui("NeoUIExample")
    
    -- 创建窗口
    local window, content = self:CreateWindow("ExampleWindow", screenGui, "NeoUI 示例", UDim2.new(0, 350, 0, 500), UDim2.new(0.5, -175, 0.5, -250))
    
    -- 添加组件示例
    local yOffset = 10
    
    -- 标签
    local titleLabel = self:CreateLabel("Title", content, "UI 组件示例", UDim2.new(1, -20, 0, 30), UDim2.new(0, 10, 0, yOffset), "title")
    yOffset = yOffset + 40
    
    -- 按钮
    local testButton = self:CreateButton("TestButton", content, "点击我!", UDim2.new(1, -20, 0, 40), UDim2.new(0, 10, 0, yOffset), "primary")
    testButton.MouseButton1Click:Connect(function()
        print("按钮被点击了!")
    end)
    yOffset = yOffset + 50
    
    -- 文本框
    local textBoxLabel = self:CreateLabel("TextBoxLabel", content, "文本框:", UDim2.new(1, -20, 0, 20), UDim2.new(0, 10, 0, yOffset), "body")
    yOffset = yOffset + 25
    local textBox = self:CreateTextBox("TestTextBox", content, "输入一些文字...", UDim2.new(1, -20, 0, 35), UDim2.new(0, 10, 0, yOffset))
    yOffset = yOffset + 45
    
    -- 滑动条
    local sliderLabel = self:CreateLabel("SliderLabel", content, "滑动条:", UDim2.new(1, -20, 0, 20), UDim2.new(0, 10, 0, yOffset), "body")
    yOffset = yOffset + 25
    local slider = self:CreateSlider("TestSlider", content, 0, 100, 50, UDim2.new(1, -20, 0, 30), UDim2.new(0, 10, 0, yOffset))
    slider.OnValueChanged:Connect(function(value)
        print("滑动条值:", value)
    end)
    yOffset = yOffset + 40
    
    -- 切换开关
    local toggleLabel = self:CreateLabel("ToggleLabel", content, "切换开关:", UDim2.new(1, -20, 0, 20), UDim2.new(0, 10, 0, yOffset), "body")
    yOffset = yOffset + 25
    local toggle = self:CreateToggle("TestToggle", content, false, UDim2.new(0, 50, 0, 25), UDim2.new(0, 10, 0, yOffset))
    toggle.OnStateChanged:Connect(function(state)
        print("切换开关状态:", state)
    end)
    yOffset = yOffset + 35
    
    -- 下拉菜单
    local dropdownLabel = self:CreateLabel("DropdownLabel", content, "下拉菜单:", UDim2.new(1, -20, 0, 20), UDim2.new(0, 10, 0, yOffset), "body")
    yOffset = yOffset + 25
    local dropdown = self:CreateDropdown("TestDropdown", content, {"选项1", "选项2", "选项3", "选项4"}, "选择选项...", UDim2.new(1, -20, 0, 35), UDim2.new(0, 10, 0, yOffset))
    dropdown.OnOptionSelected:Connect(function(option)
        print("选择的选项:", option)
    end)
    
    return screenGui
end

return NeoUI